function DM = DMatrix(xi, HexaConstants, ArmConstants)

mb  = HexaConstants.Mass;
ml1 = ArmConstants.Mass1;
ml2 = ArmConstants.Mass2;

L   = ArmConstants.Hexa_to_joint_L;

l1  = ArmConstants.l1_dim(1);

c1  = ArmConstants.MC1;
c2  = ArmConstants.MC2;

Hb = HexaConstants.Inertia;
Hbx = Hb(1, 1); Hby = Hb(2, 2); Hbz = Hb(3, 3);

H1 = ArmConstants.Inertia1;
H1xx = H1(1, 1); H1yy = H1(2, 2); H1zz = H1(3, 3);

H2 = ArmConstants.Inertia2;
H2xx = H2(1, 1); H2yy = H2(2, 2); H2zz = H2(3, 3);

phi = xi(4);
th  = xi(5);
psi = xi(6);
q1  = xi(7);
q2  = xi(8);

[D11, D12, D13, D14, D15, D16, D17, D18] = get_D1();
[D22, D23, D24, D25, D26, D27, D28] = get_D2();
[D33, D34, D35, D36, D37, D38] = get_D3();
[D44, D45, D46, D47, D48] = get_D4();
[D55, D56, D57, D58] = get_D5();
[D66, D67, D68] = get_D6();
[D77, D78] = get_D7();
D88=H2zz+c2^2*ml2;

DM = [D11, D12, D13, D14, D15, D16, D17, D18;...
      D12, D22, D23, D24, D25, D26, D27, D28;...
      D13, D23, D33, D34, D35, D36, D37, D38;...
      D14, D24, D34, D44, D45, D46, D47, D48;...
      D15, D25, D35, D45, D55, D56, D57, D58;...
      D16, D26, D36, D46, D56, D66, D67, D68;...
      D17, D27, D37, D47, D57, D67, D77, D78;...
      D18, D28, D38, D48, D58, D68, D78, D88];

function [D11, D12, D13, D14, D15, D16, D17, D18] = get_D1()
D11=mb+ml1+ml2;
D12=0;
D13=0;
D14=sin(phi)*(sin(psi)*((c1*ml1+l1*ml2)*sin(q1)+c2*ml2*sin(q1+q2))+ ...
  cos(psi)*(L*(ml1+ml2)+c2*ml2*cos(q1+q2))*sin(th))+cos(phi)*(- ...
  L*(ml1+ml2)*sin(psi)+c2*ml2*sin(psi)*sin(q1)*sin(q2)+cos(psi)*( ...
  c1*ml1+l1*ml2+c2*ml2*cos(q2))*sin(q1)*sin(th))+cos(q1)*((c1*ml1+ ...
  l1*ml2)*cos(psi)*sin(phi)*sin(th)+cos(phi)*(-(c1*ml1+l1*ml2+ ...
  c2*ml2*cos(q2))*sin(psi)+c2*ml2*cos(psi)*sin(q2)*sin(th)));
D15=-cos(psi)*(L*(ml1+ml2)*cos(phi)+(c1*ml1+l1*ml2)*cos(phi+q1)+ ...
  c2*ml2*cos(phi+q1+q2))*cos(th);
D16=cos(phi)*(-cos(psi)*((c1*ml1+l1*ml2)*sin(q1)+c2*ml2*sin(q1+ ...
  q2))+(L*(ml1+ml2)+(c1*ml1+l1*ml2)*cos(q1)+c2*ml2*cos(q1+q2))*sin( ...
  psi)*sin(th))-sin(phi)*(cos(psi)*(L*(ml1+ml2)+(c1*ml1+l1* ...
  ml2)*cos(q1)+c2*ml2*cos(q1+q2))+sin(psi)*((c1*ml1+l1*ml2)*sin(q1) ...
  +c2*ml2*sin(q1+q2))*sin(th));
D17=ml2*(l1*sin(q1)+c2*sin(q1+q2))*(sin(phi)*sin(psi)+cos(phi)*cos( ...
  psi)*sin(th))+c1*ml1*sin(phi)*(sin(psi)*sin(q1)+cos(psi)*cos(q1)* ...
  sin(th))+ml2*(l1*cos(q1)+c2*cos(q1+q2))*(-cos(phi)*sin(psi)+ ...
  cos(psi)*sin(phi)*sin(th))+c1*ml1*cos(phi)*(-cos(q1)*sin(psi) ...
  +cos(psi)*sin(q1)*sin(th));
D18=ml2*(c2*sin(q1+q2)*(sin(phi)*sin(psi)+cos(phi)*cos(psi)*sin(th))+ ...
  c2*cos(q1+q2)*(-cos(phi)*sin(psi)+cos(psi)*sin(phi)*sin(th)));
end

function [D22, D23, D24, D25, D26, D27, D28] = get_D2()
D22=mb+ml1+ml2;
D23=0;
D24=ml2*cos(psi)*(L*cos(phi)+l1*cos(phi+q1)+c2*cos(phi+q1+q2))*cos(th) ...
  ^2+ml1*sin(phi)*(-c1*cos(psi)*sin(q1)+(L+c1*cos(q1))*sin( ...
  psi)*sin(th))+ml1*cos(phi)*(cos(psi)*(L+c1*cos(q1))+c1*sin(psi)* ...
  sin(q1)*sin(th))+ml2*sin(th)*((L+l1*cos(q1)+c2*cos(q1+q2))*(sin( ...
  phi)*sin(psi)+cos(phi)*cos(psi)*sin(th))-(l1*sin(q1)+c2*sin( ...
  q1+q2))*(-cos(phi)*sin(psi)+cos(psi)*sin(phi)*sin(th)));
D25=-(L*(ml1+ml2)*cos(phi)+(c1*ml1+l1*ml2)*cos(phi+q1)+c2*ml2* ...
  cos(phi+q1+q2))*cos(th)*sin(psi);
D26=-ml1*(L+c1*cos(q1))*(sin(phi)*sin(psi)+cos(phi)*cos(psi)*sin( ...
  th))-ml2*(L+l1*cos(q1)+c2*cos(q1+q2))*(sin(phi)*sin(psi)+cos( ...
  phi)*cos(psi)*sin(th))+c1*ml1*sin(q1)*(-cos(phi)*sin(psi)+ ...
  cos(psi)*sin(phi)*sin(th))+ml2*(l1*sin(q1)+c2*sin(q1+q2))*(- ...
  cos(phi)*sin(psi)+cos(psi)*sin(phi)*sin(th));
D27=-((c1*ml1+l1*ml2)*sin(q1)+c2*ml2*sin(q1+q2))*(cos(psi)*sin( ...
  phi)-cos(phi)*sin(psi)*sin(th))+(c1*ml1+l1*ml2)*cos(q1)*( ...
  cos(phi)*cos(psi)+sin(phi)*sin(psi)*sin(th))+c2*ml2*cos(q1+q2)*( ...
  cos(phi)*cos(psi)+sin(phi)*sin(psi)*sin(th));
D28=ml2*(c2*sin(q1+q2)*(-cos(psi)*sin(phi)+cos(phi)*sin(psi)*sin( ...
  th))+c2*cos(q1+q2)*(cos(phi)*cos(psi)+sin(phi)*sin(psi)*sin(th))); 
end

function [D33, D34, D35, D36, D37, D38] = get_D3()
D33=mb+ml1+ml2;
D34=cos(th)*(L*(ml1+ml2)*sin(phi)+(c1*ml1+l1*ml2)*sin(phi+q1)+c2* ...
  ml2*sin(phi+q1+q2));
D35=(L*(ml1+ml2)*cos(phi)+(c1*ml1+l1*ml2)*cos(phi+q1)+c2*ml2*cos(phi+ ...
  q1+q2))*sin(th);
D36=0;
D37=cos(th)*((c1*ml1+l1*ml2)*sin(phi+q1)+c2*ml2*sin(phi+q1+q2));
D38=c2*ml2*cos(th)*sin(phi+q1+q2);
end

function [D44, D45, D46, D47, D48] = get_D4()
D44=H1zz+H2zz+Hbx+c1^2*ml1+L^2*ml1+c2^2*ml2+L^2*ml2+l1^2*ml2+2* ...
  L*(c1*ml1+l1*ml2)*cos(q1)+2*c2*l1*ml2*cos(q2)+2*c2*L*ml2* ...
  cos(q1+q2);
D45=0;
D46=-(H1zz+H2zz+Hbx+c1^2*ml1+L^2*ml1+c2^2*ml2+L^2*ml2+l1^2* ...
  ml2+2*L*(c1*ml1+l1*ml2)*cos(q1)+2*c2*l1*ml2*cos(q2)+2*c2*L* ...
  ml2*cos(q1+q2))*sin(th);
D47=H1zz+H2zz+c1^2*ml1+c2^2*ml2+l1^2*ml2+L*(c1*ml1+l1*ml2)*cos(q1) ...
  +2*c2*l1*ml2*cos(q2)+c2*L*ml2*cos(q1+q2);
D48=H2zz+c2^2*ml2+c2*l1*ml2*cos(q2)+c2*L*ml2*cos(q1+q2);
end

function [D55, D56, D57, D58] = get_D5()
D55=(1/2)*(H1xx+H1yy+H2xx+H2yy+Hby+Hbz+c1^2*ml1+L^2*ml1+c2^2*ml2+ ...
  L^2*ml2+l1^2*ml2+Hby*cos(2*phi)-Hbz*cos(2*phi)+L^2*ml1* ...
  cos(2*phi)+L^2*ml2*cos(2*phi)+2*L*(c1*ml1+l1*ml2)*cos(q1)+(-1) ...
  *H1xx*cos(2*(phi+q1))+H1yy*cos(2*(phi+q1))+c1^2*ml1*cos(2*(phi+ ...
  q1))+l1^2*ml2*cos(2*(phi+q1))+2*c1*L*ml1*cos(2*phi+q1)+2*L* ...
  l1*ml2*cos(2*phi+q1)+2*c2*l1*ml2*cos(q2)+2*c2*L*ml2*cos(q1+ ...
  q2)-H2xx*cos(2*(phi+q1+q2))+H2yy*cos(2*(phi+q1+q2))+c2^2* ...
  ml2*cos(2*(phi+q1+q2))+2*c2*L*ml2*cos(2*phi+q1+q2)+2*c2*l1* ...
  ml2*cos(2*(phi+q1)+q2));
D56=(1/2)*cos(th)*((Hby-Hbz+L^2*(ml1+ml2))*sin(2*phi)+(- ...
  H1xx+H1yy+c1^2*ml1+l1^2*ml2)*sin(2*(phi+q1))+2*c1*L*ml1*sin( ...
  2*phi+q1)+2*L*l1*ml2*sin(2*phi+q1)-H2xx*sin(2*(phi+q1+q2)) ...
  +H2yy*sin(2*(phi+q1+q2))+c2^2*ml2*sin(2*(phi+q1+q2))+2*c2*L* ...
  ml2*sin(2*phi+q1+q2)+2*c2*l1*ml2*sin(2*(phi+q1)+q2));
D57=0;
D58=0;
end

function [D66, D67, D68] = get_D6()
D66=Hbz*cos(phi)^2*cos(th)^2+(1/2)*cos(phi)^2*(H2xx+H2yy+(H2xx- ...
  H2yy)*cos(2*(q1+q2)))*cos(th)^2+Hby*cos(th)^2*sin(phi)^2+(1/2)* ...
  (H2xx+H2yy+(-H2xx+H2yy)*cos(2*(q1+q2)))*cos(th)^2*sin(phi)^2+ ...
  2*(-H1xx+H1yy)*cos(phi)*cos(q1)*cos(th)^2*sin(phi)*sin(q1)+ ...
  cos(th)^2*sin(phi)^2*(H1yy*cos(q1)^2+H1xx*sin(q1)^2)+cos(phi) ...
  ^2*cos(th)^2*(H1xx*cos(q1)^2+H1yy*sin(q1)^2)-(H2xx- ...
  H2yy)*cos(phi)*cos(th)^2*sin(phi)*sin(2*(q1+q2))+H1zz*sin(th)^2+ ...
  H2zz*sin(th)^2+Hbx*sin(th)^2+ml1*(-(L+c1*cos(q1))*(sin(phi) ...
  *sin(psi)+cos(phi)*cos(psi)*sin(th))+c1*sin(q1)*(-cos(phi)* ...
  sin(psi)+cos(psi)*sin(phi)*sin(th)))^2+ml2*(-(L+l1*cos(q1)+ ...
  c2*cos(q1+q2))*(sin(phi)*sin(psi)+cos(phi)*cos(psi)*sin(th))+(l1* ...
  sin(q1)+c2*sin(q1+q2))*(-cos(phi)*sin(psi)+cos(psi)*sin(phi)* ...
  sin(th)))^2+ml1*((L+c1*cos(q1))*(cos(psi)*sin(phi)-cos(phi)* ...
  sin(psi)*sin(th))+c1*sin(q1)*(cos(phi)*cos(psi)+sin(phi)*sin(psi)* ...
  sin(th)))^2+ml2*((L+l1*cos(q1)+c2*cos(q1+q2))*(cos(psi)*sin(phi)+( ...
  -1)*cos(phi)*sin(psi)*sin(th))+(l1*sin(q1)+c2*sin(q1+q2))*(cos( ...
  phi)*cos(psi)+sin(phi)*sin(psi)*sin(th)))^2;
D67=-(H1zz+H2zz+c1^2*ml1+c2^2*ml2+l1^2*ml2+L*(c1*ml1+l1*ml2)* ...
  cos(q1)+2*c2*l1*ml2*cos(q2)+c2*L*ml2*cos(q1+q2))*sin(th);
D68=-(H2zz+c2^2*ml2+c2*l1*ml2*cos(q2)+c2*L*ml2*cos(q1+q2))* ...
  sin(th);
end

function [D77, D78] = get_D7()
D77=H1zz+H2zz+c1^2*ml1+c2^2*ml2+l1^2*ml2+2*c2*l1*ml2*cos(q2);
D78=H2zz+c2^2*ml2+c2*l1*ml2*cos(q2);
end

end